<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <title>Find Donor</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
</head>
<body class="bg-light">
<div class="container mt-5">
  <h2 class="mb-4 text-danger">Find Donor</h2>

  {% if message %}
  <div class="alert alert-warning">{{ message }}</div>
  {% endif %}

  <form method="POST" action="/find_donors" class="row g-3 mb-5">
    <div class="col-md-4">
      <label class="form-label">Blood Group</label>
      <input name="blood_group" class="form-control" required>
    </div>

    <div class="col-md-4">
      <label class="form-label">Your Latitude</label>
      <input type="number" step="0.0001" name="user_lat" class="form-control" required>
    </div>

    <div class="col-md-4">
      <label class="form-label">Your Longitude</label>
      <input type="number" step="0.0001" name="user_lon" class="form-control" required>
    </div>

    <div class="col-12 d-flex gap-2">
      <!-- normal search button -->
      <button class="btn btn-danger">Search</button>
      <!-- use my location button -->
      <button type="button" class="btn btn-secondary" onclick="getLocation()">Use My Location</button>
    </div>
  </form>

  {% if donors %}
  <h4 class="mb-3">Eligible Donors</h4>
  <table class="table table-striped table-bordered">
    <thead class="table-danger">
      <tr>
        <th>Name</th>
        <th>Contact</th>
        <th>Address</th>
        <th>Distance (km)</th>
      </tr>
    </thead>
    <tbody>
      {% for donor in donors %}
      <tr>
        <td>{{ donor.name }}</td>
        <td>{{ donor.contact }}</td>
        <td>{{ donor.address }}</td>
        <td>{{ donor.distance_km }}</td>
      </tr>
      {% endfor %}
    </tbody>
  </table>
  {% endif %}
</div>

<!-- put script at bottom of body -->
<script>
function getLocation() {
  if (navigator.geolocation) {
    navigator.geolocation.getCurrentPosition(function(position) {
      // fill your latitude and longitude fields
      document.querySelector('input[name="user_lat"]').value = position.coords.latitude;
      document.querySelector('input[name="user_lon"]').value = position.coords.longitude;
    }, function(error) {
      alert("Could not get your location: " + error.message);
    });
  } else {
    alert("Geolocation is not supported by this browser.");
  }
}
</script>
</body>
</html>
